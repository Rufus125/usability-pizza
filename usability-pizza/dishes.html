<!DOCTYPE html>
<html>
<head>
    <title>Usability pizza</title>
    <!--Header links -->
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <!-- jQuery -->
    <script src="jquery.min.js"></script>
    <!-- sort and filter -->
    <script src="jquery.fastLiveFilter.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</head>
<body>
<header>
    <!--<div class="logo">logo</div>-->
    <a href="index.html">
        <img src="i-takeaway%20logo.png" alt="Logo i-Takeaway">
    </a>
</header>

<nav>
    <p id="restaurant-display">Please choose restaurant</p>
    Menu
    <form method="get" action="restaurant-choice.html">
        <input type="hidden" name="restaurant" id="restaurant" value="">
        <input type="submit" value="Back">
    </form>
</nav>
<div id="search">
<input type="search" id="search_input" placeholder="Type to filter">

<ul id="dishes_list">
    <li><a href="#" onclick="copyToText(this);">Pizza</a>
        <span class="input-group-btn">
              <button type="button" class="btn btn-default btn-number" disabled data-type="minus" data-field="pizzaNum">
                  <span class="glyphicon glyphicon-minus"></span>
              </button>
          </span>
        <input type="number" class="input-number" name="pizzaNum" value="0" min="0" max="20">
                <span class="input-group-btn">
              <button type="button" class="btn btn-default btn-number" data-type="plus" data-field="pizzaNum">
                  <span class="glyphicon glyphicon-plus"></span>
              </button>
              <button type="button" class="btn btn-default btn-number" data-type="remove" data-field="pizzaNum">
                  <span class="glyphicon glyphicon-remove"></span>
              </button>
          </span>
    </li>
    <li><a href="#" onclick="copyToText(this);">Pasta</a>
     <span class="input-group-btn">
              <button type="button" class="btn btn-default btn-number" disabled data-type="minus" data-field="pastaNum">
                  <span class="glyphicon glyphicon-minus"></span>
              </button>
          </span>
        <input type="number" class="input-number" name="pastaNum" value="0" min="0" max="20">
                <span class="input-group-btn">
              <button type="button" class="btn btn-default btn-number" data-type="plus" data-field="pastaNum">
                  <span class="glyphicon glyphicon-plus"></span>
              </button>
              <button type="button" class="btn btn-default btn-number" data-type="remove" data-field="pastaNum">
                  <span class="glyphicon glyphicon-remove"></span>
              </button>
          </span>
    </li>
</ul>
</div>
    <form method="get" action="index.html">
        Total price: <span id="total">0.00</span><br/>
        <input type="submit" value="Proceed">
        <!--the actual list here -->
    </form>

<div id="footer"></div>
</body>

<script>
    $(function () {
        $('#search_input').fastLiveFilter('#dishes_list');
    });
</script>

<script>
    function getQueryParams(qs) {
        qs = qs.split("+").join(" ");
        var params = {},
                tokens,
                re = /[?&]?([^=]+)=([^&]*)/g;

        while (tokens = re.exec(qs)) {
            params[decodeURIComponent(tokens[1])]
                    = decodeURIComponent(tokens[2]);
        }

        return params;
    }

    var $_GET = getQueryParams(document.location.search);;
    var restaurant = $_GET["restaurant"];
    if(restaurant != undefined) {
        restaurant = restaurant.charAt(0).toUpperCase() + restaurant.substr(1);
        $('#restaurant').val(restaurant);
        $('#restaurant-display').text(restaurant);
    }
</script>

<script>
    function copyToText(listele) {
        dish= listele.text.replace(/^\s+|\s+$/g, '');;
        $('#search_input').val(dish);
    }

</script>

<script>
    $('.btn-number').click(function(e){
        e.preventDefault();

        var fieldName = $(this).attr('data-field');
        var type      = $(this).attr('data-type');
        var input = $("input[name='"+fieldName+"']");
        var currentVal = parseInt(input.val());
        if (!isNaN(currentVal)) {
            if(type == 'minus') {

                if(currentVal > input.attr('min')) {
                    input.val(currentVal - 1).change();
                }
                if(parseInt(input.val()) == input.attr('min')) {
                    $(this).attr('disabled', true);
                }
            }
            else  if(type == 'remove') {
                    input.val(0).change();
                    var buttons =  $('.btn-number');
                    for ( var i = 0; i < buttons.length; i++ ) {
                        var button = buttons[i];
                        if (button.getAttribute('data-field') == fieldName) {
                            if (button.getAttribute('data-type') == 'minus') {
                                button.setAttribute('disabled', true);
                            }
                        }
                    }
                    /*
                     <button type="button" class="btn btn-default btn-number" disabled data-type="minus" data-field="pastaNum">
                     <span class="glyphicon glyphicon-minus"></span>
                     </button>
                     */
                }
             else if(type == 'plus') {
                if(currentVal < input.attr('max')) {
                    $(this).attr('disabled', false);
                    input.val(currentVal + 1).change();
                }
                if(parseInt(input.val()) == input.attr('max')) {
                }

            }
        } else {
            input.val(0);
        }
        var sum=0.00;
        //recalculate the price in total so that the price is up to date
        /*
        iterate over each list item
          get price and count
          add to total sum
        set total sum.
         */
        $( "#dishes_list li" ).each(function() {
            var number = $(this).children('input').val();
            number = parseInt(number);
            //var amount = $(this).children('').val();
            // amount =  = parseInt(amount);
            var amount = 2;
            sum = sum+ number * amount;
        });
        $( "#total" ).text(sum.toFixed(2));
    });

    $('.input-number').change(function() {
        minValue =  parseInt($(this).attr('min'));
        maxValue =  parseInt($(this).attr('max'));
        valueCurrent = parseInt($(this).val());

        name = $(this).attr('name');
        if(valueCurrent >= minValue) {
            $(".btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
        } else {
            alert('Sorry, the minimum value was reached');
            $(this).val($(this).data('oldValue'));
        }
        if(valueCurrent <= maxValue) {
            $(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
        } else {
            alert('Sorry, the maximum value was reached');
            $(this).val($(this).data('oldValue'));
        }


    });


</script>
</html>